#!/bin/bash

# Gerrit setup & workflow
# https://triadmoj.atlassian.net/wiki/pages/viewpage.action?pageId=18809272

TEST=$(pwd | tail -c 6)
#if [ "$TEST" == "/.git" ]; then
GITCONFIG=".git/config"
PORT="29418"
GETGITURL=$(grep url $GITCONFIG | awk '{print $3}')
GETGITHOST=$(grep url $GITCONFIG | awk '{print $3}' | cut -d ":" -f2 | tr -d "/")

if grep '\[remote \"review\"\]' $GITCONFIG;
 then
     echo "setmeup has already run"
 else
     echo "Setting you up!"
     echo '[remote "review"]' >> $GITCONFIG
     echo "  pushurl= ${GETGITURL}" >> $GITCONFIG
     echo "  push = HEAD:refs/for/dev/ATCM-781/structure-framework-migration" >> $GITCONFIG
     echo "  receivepack = git receive-pack --reviewer e.mccormack@kainos.com --reviewer j.oliver@kainos.com --reviewer atcm@friesen.co.uk --reviewer max@cautionyourblast.com --reviewer s.watson@kainos.com --reviewwer tim@codebassist.co.uk" >> $GITCONFIG
     scp -p -P 29418 $GETGITHOST:hooks/commit-msg hooks/.
     echo "Done"
fi
#else
#echo "Please run me from ./git"
#fi
