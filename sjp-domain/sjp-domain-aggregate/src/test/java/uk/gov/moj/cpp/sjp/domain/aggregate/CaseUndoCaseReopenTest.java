package uk.gov.moj.cpp.sjp.domain.aggregate;

import static uk.gov.moj.cpp.sjp.domain.aggregate.CaseAggregateBaseTest.AggregateTester.when;

import uk.gov.moj.cpp.sjp.domain.CaseReopenDetails;
import uk.gov.moj.cpp.sjp.event.CaseNotReopened;
import uk.gov.moj.cpp.sjp.event.CaseReopenedUndone;

import org.junit.Test;

/**
 * Tests for {@link CaseAggregate#undoCaseReopened}
 */
public class CaseUndoCaseReopenTest extends CaseAggregateBaseTest {

    private static final String LIBRA_CASE_NUMBER = "LIBRA12345";
    private static final String REASON = "Mandatory reason";

    @Test
    public void shouldFailWhenCaseNeverRepened() {
        when(caseAggregate.undoCaseReopened(caseId))
                .thenExpect(new CaseNotReopened(caseId, "Cannot undo case reopened"));
    }

    @Test
    public void shouldFailReopenCaseNotOpened() {
        caseAggregate.markCaseReopened(new CaseReopenDetails(caseId, clock.now().toLocalDate(), LIBRA_CASE_NUMBER, REASON));

        when(caseAggregate.undoCaseReopened(caseId))
                .thenExpect(new CaseReopenedUndone(caseId, clock.now().toLocalDate()));
    }

}
