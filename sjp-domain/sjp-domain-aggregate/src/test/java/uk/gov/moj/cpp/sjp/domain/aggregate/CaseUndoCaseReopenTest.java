package uk.gov.moj.cpp.sjp.domain.aggregate;

import static uk.gov.moj.cpp.sjp.domain.aggregate.CaseAggregateBaseTest.AggregateTester.when;
import static uk.gov.moj.cpp.sjp.domain.common.CaseStatus.NO_PLEA_RECEIVED;
import static uk.gov.moj.cpp.sjp.domain.common.CaseStatus.PLEA_RECEIVED_NOT_READY_FOR_DECISION;

import uk.gov.moj.cpp.sjp.domain.CaseReopenDetails;
import uk.gov.moj.cpp.sjp.domain.common.CaseStatus;
import uk.gov.moj.cpp.sjp.event.CaseNotReopened;
import uk.gov.moj.cpp.sjp.event.CaseReopenedUndone;
import uk.gov.moj.cpp.sjp.event.CaseStatusChanged;

import org.junit.jupiter.api.Test;

/**
 * Tests for {@link CaseAggregate#undoCaseReopened}
 */
public class CaseUndoCaseReopenTest extends CaseAggregateBaseTest {
    private static final String LIBRA_CASE_NUMBER = "LIBRA12345";
    private static final String REASON = "Mandatory reason";

    @Test
    public void shouldFailWhenCaseNeverReopened() {
        when(caseAggregate.undoCaseReopened(caseId))
                .thenExpect(new CaseNotReopened(caseId, "Cannot undo case reopened"));
    }

    @Test
    public void shouldFailReopenCaseNotOpened() {
        caseAggregate.markCaseReopened(new CaseReopenDetails(caseId, clock.now().toLocalDate(), LIBRA_CASE_NUMBER, REASON));

        when(caseAggregate.undoCaseReopened(caseId))
                .thenExpect(new CaseReopenedUndone(caseId, clock.now().toLocalDate()),
                        new CaseStatusChanged(caseId, NO_PLEA_RECEIVED));
    }

}
